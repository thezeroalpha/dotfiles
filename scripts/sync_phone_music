#!/usr/bin/env bash
command -v rsync &>/dev/null || { echo "rsync not found." && exit 1; }
[ $# -ge 1 ] || { echo "The volume is required as an argument." && exit 1; }

# set creation dates to date of modification
#while read -r f; do echo "$f"; SetFile -d "$(GetFileInfo -m $f)" "$f"; done < <(find .)

diffout=$(diff <(find "$1" -mindepth 1 -type f -not -name .DS_Store | sed 's:^.*Music/::' | sort | tr -d '\r') <(find "$MUSIC_DIR" -mindepth 1 -type f -not -name .DS_Store | sed 's:^.*Music/::' | sort | tr -d '\r'))

echo -e "$1\tvs\t$MUSIC_DIR"
if [ -z "$diffout" ]; then
  echo "No difference."
else
  echo "$diffout"
fi
find "$1" -name .DS_Store -delete
dot_clean -m .
