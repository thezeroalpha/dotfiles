# vim: syntax=neomuttrc
# Receive
source secret
set imap_user=$my_school_username
set imap_pass=$my_school_pass_id
set folder = ~/.local/share/mail/$my_school_email/
set postponed = +Drafts
set trash = +"Deleted Items"
set record = ""     # office365 automatically saves sent mail
set mbox = +Archive


# unmailboxes *
# mailboxes +Inbox +Archive +Drafts +"Sent Items" +"Deleted Items" +"Junk Email"
# set spoolfile = +Inbox
# For notmuch:
unmailboxes *
unvirtual-mailboxes *
virtual-mailboxes \
  "Inbox (S)" "notmuch://?query=folder:$my_school_email/Inbox" \
  "Archive (S)" "notmuch://?query=folder:$my_school_email/Archive" \
  "Drafts (S)" "notmuch://?query=folder:$my_school_email/Drafts" \
  "Sent (S)" "notmuch://?query='folder:\"$my_school_email/Sent Items\"'" \
  "Trash (S)" "notmuch://?query='folder:\"$my_school_email/Deleted Items\"'" \
  "Spam (S)" "notmuch://?query='folder:\"$my_school_email/Junk Email\"'"
set spoolfile = "Inbox (S)"

set header_cache = ~/.cache/mutt/$my_school_email/headers
set message_cachedir = ~/.cache/mutt/$my_school_email/bodies

# Send
set realname=$my_name
set from=$my_school_email
set sendmail="msmtp -a $my_school_email"
set sendmail_wait = 0
alias me $realname <$my_school_email>
set signature=""
set ssl_force_tls = yes
set ssl_starttls = yes

# Hook -- IMPORTANT!
account-hook $folder "set imap_user=$my_school_email imap_pass=$my_school_pass_cmd"

# Retrieve new email
macro index O "<shell-escape>mbsync -c ~/.config/mbsync/mbsyncrc $my_school_email && notmuch-hook<enter>" "run mbsync to sync $my_school_email"
macro index o "<shell-escape>mbsync -c ~/.config/mbsync/mbsyncrc $my_school_email:INBOX,'Sent Items' && notmuch-hook<enter>" "run mbsync to sync all mail"

# Delete
macro index,pager d "\
<delete-message>\
<modify-labels-then-hide>-inbox -archive -draft -spam +trash -sent -unread<enter>"

# Actually delete
bind index,pager D purge-message

# Undelete
macro index,pager u "\
<undelete-message>\
<modify-labels-then-hide>-trash<enter>"

# Changing folders
macro index,pager gi "<change-vfolder>Inbox (S)<enter>" "go to Inbox"
macro index,pager ga "<change-vfolder>Archive (S)<enter>" "go to Archive"
macro index,pager gd "<change-vfolder>Drafts (S)<enter>" "go to Drafts"
macro index,pager gj "<change-vfolder>Spam (S)<enter>" "go to Spam"
macro index,pager gt "<change-vfolder>Trash (S)<enter>" "go to Trash"
macro index,pager gs "<change-vfolder>Sent (S)<enter>" "go to Sent"

# Moving emails
macro index,pager MI "<modify-labels>+inbox -archive -draft -spam -trash -sent -unread<enter><save-message>=Inbox<enter>" "move mail to Inbox"
macro index,pager MA "<modify-labels>-inbox +archive -draft -spam -trash -sent -unread<enter><save-message>=Archive<enter>" "move mail to Archive"
macro index,pager a "<modify-labels>-inbox +archive -draft -spam -trash -sent -unread<enter><save-message>=Archive<enter>" "move mail to Archive"
macro index,pager MD "<modify-labels>-inbox -archive +draft -spam -trash -sent -unread<enter><save-message>=Drafts<enter>" "move mail to Drafts"
macro index,pager MJ "<modify-labels>-inbox -archive -draft +spam -trash -sent -unread<enter><save-message>=Junk Email<enter>" "move mail to Junk Email"
macro index,pager MT "<modify-labels>-inbox -archive -draft -spam +trash -sent -unread<enter><save-message>=Deleted Items<enter>" "move mail to Deleted Items"
macro index,pager MS "<modify-labels>-inbox -archive -draft -spam -trash +sent -unread<enter><save-message>=Sent Items<enter>" "move mail to Sent Items"

